{% extends 'base.html' %}
{% block content %}
<!-- VERSION: 3.0 - NEW ROUTE /create-user -->
<h2><i class="fas fa-users-cog"></i> –¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</h2>

<div class="card">
  <h3><i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
  <form method="post" action="/create-user">
    <!-- DEBUG: Form action URL: /create-user -->
    <div class="form-group">
      <label>–õ–æ–≥–∏–Ω</label>
      <input name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
    </div>
    <div class="form-group">
      <label>Email</label>
      <input name="email" type="email" placeholder="–í–≤–µ–¥–∏—Ç–µ email" required>
    </div>
    <div class="form-group">
      <label>–ü–∞—Ä–æ–ª—å</label>
      <input name="password" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
    </div>
    <div class="form-group">
      <label>–ò–º—è</label>
      <input name="first_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
    </div>
    <div class="form-group">
      <label>–§–∞–º–∏–ª–∏—è</label>
      <input name="last_name" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
    </div>
    <div class="form-group">
      <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input name="phone" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω">
    </div>
    <div class="form-group">
      <label>–†–æ–ª—å</label>
      <select name="role" required>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
        <option value="director">üëë –î–∏—Ä–µ–∫—Ç–æ—Ä</option>
        <option value="manager">üë• –ú–µ–Ω–µ–¥–∂–µ—Ä</option>
        <option value="supplier">üöö –°–Ω–∞–±–∂–µ–Ω–µ—Ü</option>
        <option value="warehouse">üè™ –°–∫–ª–∞–¥</option>
        <option value="production">‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</option>
        <option value="accountant">üßÆ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option>
      </select>
    </div>
    <button class="btn success"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
  </form>
</div>
<div class="card">
  <h3><i class="fas fa-list"></i> –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
  <table>
    <thead>
      <tr>
        <th><i class="fas fa-hashtag"></i> ID</th>
        <th><i class="fas fa-user"></i> –õ–æ–≥–∏–Ω</th>
        <th><i class="fas fa-user-tag"></i> –†–æ–ª—å</th>
        <th><i class="fas fa-id-card"></i> –§–ò–û</th>
        <th><i class="fas fa-cogs"></i> –î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
    {% for u in users %}
      <tr>
        <td><strong>{{ u.id }}</strong></td>
        <td><strong>{{ u.username }}</strong></td>
        <td>
          <span style="padding: 4px 8px; border-radius: 12px; background: #667eea; color: white; font-size: 12px;">
            {{ u.roles[0].name if u.roles else '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞' }}
          </span>
        </td>
        <td>{{ u.first_name }} {{ u.last_name }}</td>
        <td>
          <form method="post" action="{{ url_for('reset_user_password', user_id=u.id) }}" style="display:inline; margin-right: 5px;">
            <button class="btn small" type="submit" title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å">
              <i class="fas fa-key"></i> –°–±—Ä–æ—Å
            </button>
          </form>
          <form method="post" action="{{ url_for('delete_user', user_id=u.id) }}" style="display:inline;">
            <button class="btn small danger" type="submit" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ u.username }}?')" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
              <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
            </button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
